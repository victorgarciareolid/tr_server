<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Índex</title>
	<!-- Communication library -->
	<script type="text/javascript" src="//cdn.socket.io/socket.io-1.3.4.js"></script>
	<!-- Used to manage DOM -->
	<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
	<!-- Boostrap js and styles to improve design -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
	<!-- Leafletjs -->
	<script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.6/mapbox.js'></script>
	<link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.6/mapbox.css' rel='stylesheet' />

 	<script src="amcharts/amcharts.js" type="text/javascript"></script>
	<script src="amcharts/serial.js" type="text/javascript"></script>
		
	<style>
		.chart{
			width: 640px;
			max-height: 400px;
		}
		#map {
			height: 500px;
			width: 100%; 
		}
	</style>

	<script>
	$(document).ready(function(){
		var socket = io('https://52.17.55.30', {secure:true}); // https://localhost:80 in production
		
		L.mapbox.accessToken = 'pk.eyJ1IjoidmljdG9yb3IiLCJhIjoiNWRKTUN2dyJ9.9DcllIJrvWGahws_K7ZuWA';
		var map = L.mapbox.map('map', 'victoror.ljad1pkp').setView([40, -3], 6);
		
		socket.on('data', function(d){
			d = d.data;
			console.log(d)
			for(var i=0; i < d.length; ++i){
				var new_board = d[i].name;
				var display = d[i];
				var new_board_html = '<div id="__" class=".charts"></div>'.replace('__', new_board);
				
				$('#graph').append(new_board_html);

				$('#' + new_board).append('<div id="__" class=".livechart"></div>'.replace('__', new_board));
				$('#' + new_board).append('<div id="__" class=".historicalchart"></div>'.replace('__', new_board));
				
				//var chart = new AmSerialChart();

				//chart.dataProvider = display.measurement;

				//chart.categoryField = "ppm"

				var mark = L.marker([display.location.lat, display.location.lon]).addTo(map);
				mark.bindPopup("<b>I am __!</b><br>Cool!".replace('__', new_board)).openPopup();
			}
			
		});

		socket.on('update', function(d){
			console.log(d);
		});
	});
	</script>
</head>
<body>
	<header>
		<h1>
			Título del projecto
		</h1>
	</header>

	<div id="map"></div>
	
	<div id="graph"></div>
	
	</body>
</html>